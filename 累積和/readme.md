# 累積和

## 概要

区間内の総和や最大値、最小値などのクエリを高速で処理する手法。  
前処理が必要になる。  

## 処理

例: `[1, 2, 3, 4, 5]` 内から 開始位置と終了位置内の総和を求める。  
開始位置が2, 終了位置が4のとき、答えは12になる(0-index)。  

### step1: 総和を取る

A = `[1, 2, 3, 4, 5]` と置いたときに、下記のような配列 `S` を作る

- `S[0]` = `0`  
- `S[1]` = `A[0]`
- `S[2]` = `A[0] + A[1]`
- …
- `S[N]` = `A[0] + A[1] + A[2] + … + A[N-1]`

例に対して配列Sを作ると、 `S = [0, 1, 3, 6, 10, 15]` が出来上がる。  
ここでは、この操作を前処理と呼んでいる。  

### step2: 答えを導き出す

答えは、 `S[終了位置+1] - S[開始位置]` で求めることができる。  
例では、開始位置が2, 終了位置が4だったので、

- S[5] - S[2] = 15 - 3 = 12

と答えが求まっている。

### 深掘り

それぞれの `S` の要素について深掘りしていこう
開始位置と終了位置の要素を分解してみると、

- S[2] = `A[0] + A[1]`
- S[5] = `A[0] + A[1] + A[2] + A[3] + A[4]`

となっている。

これについて `S[5] - S[2]`を行うと、 `A[0] + A[1]` 部分が消えるので、求めたかった `A[2] + A[3] + A[4]` が算出されている。  

前処理部分の配列を作るのに O(N), 答えを導くのに O(1) かかっている。
